{% extends 'index.html' %}
{% load static %}

{% block title %}จัดการแบบสอบถาม{% endblock %}

{% block extra_css %}
<style>
    .data-table { min-width: 100%; }
    .data-table thead th {
        padding: 0.75rem 1.5rem; text-align: left; font-size: 0.75rem; 
        font-weight: 500; color: #6B7280; text-transform: uppercase;
        letter-spacing: 0.05em; background-color: #F9FAFB;
    }
    .data-table tbody td {
        padding: 1rem 1.5rem; white-space: nowrap; font-size: 0.875rem;
    }
    .data-table tbody tr:nth-child(even) { background-color: #F9FAFB; }
    .tag {
        display: inline-flex; padding: 0.25em 0.75em; font-size: 0.75rem;
        font-weight: 600; line-height: 1.25rem; border-radius: 9999px;
    }
</style>
{% endblock %}


{% block main %}
<div class="w-full mx-auto" x-data="{ activeTab: 'questions' }">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">จัดการแบบสอบถาม (Admin UI)</h1>
    </div>

    <div class="mb-6 border-b border-gray-200">
        <nav class="flex -mb-px space-x-8" aria-label="Tabs">
            <button @click="activeTab = 'questions'"
                    :class="activeTab === 'questions' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="py-4 px-1 border-b-2 font-medium text-sm">
                3. คำถาม (Questions)
            </button>
            
            <button @click="activeTab = 'versions'"
                    :class="activeTab === 'versions' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="py-4 px-1 border-b-2 font-medium text-sm">
                2. เวอร์ชัน (Versions)
            </button>
            <button @click="activeTab = 'surveys'"
                    :class="activeTab === 'surveys' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                    class="py-4 px-1 border-b-2 font-medium text-sm">
                1. แบบสอบถาม (Surveys)
            </button>
        </nav>
    </div>

    <div x-show="activeTab === 'questions'" class="bg-white shadow-md rounded-lg overflow-hidden">
        <div class="p-4 flex justify-between items-center">
            <h2 class="text-xl font-semibold">รายการคำถามทั้งหมด ({{ all_questions.count }})</h2>
            <a href="{% url 'survey:question_add' %}" class="px-5 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">+ เพิ่มคำถาม</a>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>คำถาม (TH)</th>
                    <th>เวอร์ชัน (Version)</th> <th>ประเภท</th>
                    <th>ลำดับ</th>
                    <th><span class="sr-only">Edit</span></th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for q in all_questions %}
                <tr>
                    <td>{{ q.text_th|truncatechars:50 }}</td>
                    <td>
                        <div>{{ q.survey_version.version_number }}</div>
                        <div class="text-xs text-gray-400">{{ q.survey_version.survey.title_th }}</div>
                    </td>
                    <td><span class="tag bg-green-100 text-green-800">{{ q.get_question_type_display }}</span></td>
                    <td class="text-center">{{ q.order }}</td>
                    <td class="text-right">
                        <a href="{% url 'survey:question_edit' q.pk %}" class="text-indigo-600 hover:text-indigo-900">แก้ไข</a>
                        <a href="{% url 'survey:question_delete' q.pk %}" class="text-red-600 hover:text-red-900 ml-2">ลบ</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center p-4 text-gray-500">ยังไม่มีคำถาม</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div x-show="activeTab === 'versions'" class="bg-white shadow-md rounded-lg overflow-hidden">
        <div class="p-4 flex justify-between items-center">
            <h2 class="text-xl font-semibold">รายการเวอร์ชัน ({{ all_versions.count }})</h2>
            <a href="{% url 'survey:version_add' %}" class="px-5 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">
                + เพิ่มเวอร์ชัน
            </a>
        </div>
        <table class="data-table">
             <thead>
                <tr>
                    <th>ชื่อเวอร์ชัน</th>
                    <th>แบบสอบถาม (Survey)</th>
                    <th>สถานะ</th>
                    <th><span class="sr-only">Edit</span></th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for v in all_versions %}
                <tr>
                    <td>{{ v.version_number }}</td>
                    <td>{{ v.survey.title_th }}</td>
                    <td>
                        {% if v.status == 'ACTIVE' %}
                        <span class="tag bg-green-100 text-green-800">{{ v.get_status_display }}</span>
                        {% else %}
                        <span class="tag bg-gray-100 text-gray-800">{{ v.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td><a href="{% url 'survey:version_edit' v.pk %}" class="text-indigo-600">แก้ไข</a></td>
                </tr>
                {% empty %}
                <tr><td colspan="4" class="text-center p-4 text-gray-500">ยังไม่มีเวอร์ชัน</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div x-show="activeTab === 'surveys'" class="bg-white shadow-md rounded-lg overflow-hidden">
        <div class="p-4 flex justify-between items-center">
            <h2 class="text-xl font-semibold">รายการแบบสอบถามหลัก ({{ all_surveys.count }})</h2>
            <a href="{% url 'survey:survey_add' %}" class="px-5 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">
                + เพิ่มแบบสอบถาม
            </a>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>ชื่อแบบสอบถาม (TH)</th>
                    <th>ชื่อ (EN)</th>
                    <th><span class="sr-only">Edit</span></th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for s in all_surveys %}
                <tr>
                    <td>{{ s.title_th }}</td>
                    <td>{{ s.title_en }}</td>
                    <td><a href="{% url 'survey:survey_edit' s.pk %}" class="text-indigo-600">แก้ไข</a></td>
                </tr>
                {% empty %}
                <tr><td colspan="3" class="text-center p-4 text-gray-500">ยังไม่มีแบบสอบถาม</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="//unpkg.com/alpinejs" defer></script>
{% endblock %}