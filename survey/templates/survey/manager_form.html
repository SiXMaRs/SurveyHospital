{% extends 'index.html' %} 
{% block title %}{{ title }}{% endblock %}

{% block content %} 
<h1 class="text-3xl font-semibold text-gray-800 mb-6">{{ title }}</h1>

{# --- Summary Cards ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏°‡∏≤) --- #}
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
        <span class="text-3xl text-yellow-500 mb-2">üí°</span>
        <p class="text-sm text-gray-500">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
        <p class="text-2xl font-bold text-gray-800">{{ total_managers|default:0 }}</p>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
        <span class="text-3xl text-blue-500 mb-2">üë•</span>
        <p class="text-sm text-gray-500">‡∏à‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
        <p class="text-2xl font-bold text-gray-800">{{ total_service_points|default:0 }}</p>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
        <span class="text-3xl text-pink-500 mb-2">üóìÔ∏è</span>
        <p class="text-sm text-gray-500">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</p>
        <p class="text-2xl font-bold text-gray-800">{{ total_service_groups|default:0 }}</p>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
        <span class="text-3xl text-teal-500 mb-2">üü¢</span>
        <p class="text-sm text-gray-500">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
        <p class="text-2xl font-bold text-gray-800">{{ online_managers|default:0 }}</p>
    </div>
</div>

<div class="bg-white shadow-md rounded-lg p-6">
    
    {# --- Tabs --- #}
    <div class="border-b border-gray-200 mb-6">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <a href="{% url 'survey:manager_list' %}" 
               class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
            </a>
            <a href="{% url 'survey:manager_add' %}" 
               class="{% if request.resolver_match.view_name == 'survey:manager_add' %}border-green-600 text-green-600{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
            </a>
            {% if manager %} 
            <span class="border-green-600 text-green-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
            </span>
            {% endif %}
        </nav>
    </div>

    <form method="POST" action="">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
            <div class="p-4 mb-6 bg-red-100 border border-red-400 text-red-700 rounded-md">
                <p class="font-bold">‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</p>
                {{ form.non_field_errors }}
            </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-6 ">
            
            {# --- ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) --- #}
            <div class="space-y-6"> 
                <div>
                    <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.username.label }}</label>
                    <input type="text" name="{{ form.username.name }}" id="{{ form.username.id_for_label }}"
                           value="{{ form.username.value|default:'' }}"
                           class="mt-1 block w-full px-3 py-2 border {% if form.username.errors %}border-red-500{% else %}border-gray-300{% endif %} rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
                    {% if form.username.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ form.username.errors|striptags }}</p>
                    {% endif %}
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.first_name.label }}</label>
                        <input type="text" name="{{ form.first_name.name }}" id="{{ form.first_name.id_for_label }}"
                               value="{{ form.first_name.value|default:'' }}"
                               class="mt-1 block w-full px-3 py-2 border {% if form.first_name.errors %}border-red-500{% else %}border-gray-300{% endif %} rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
                        {% if form.first_name.errors %}
                            <p class="mt-2 text-sm text-red-600">{{ form.first_name.errors|striptags }}</p>
                        {% endif %}
                    </div>
                    <div>
                        <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.last_name.label }}</label>
                        <input type="text" name="{{ form.last_name.name }}" id="{{ form.last_name.id_for_label }}"
                               value="{{ form.last_name.value|default:'' }}"
                               class="mt-1 block w-full px-3 py-2 border {% if form.last_name.errors %}border-red-500{% else %}border-gray-300{% endif %} rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
                        {% if form.last_name.errors %}
                            <p class="mt-2 text-sm text-red-600">{{ form.last_name.errors|striptags }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div>
                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.email.label }}</label>
                    <input type="email" name="{{ form.email.name }}" id="{{ form.email.id_for_label }}"
                           value="{{ form.email.value|default:'' }}"
                           class="mt-1 block w-full px-3 py-2 border {% if form.email.errors %}border-red-500{% else %}border-gray-300{% endif %} rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
                    {% if form.email.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ form.email.errors|striptags }}</p>
                    {% endif %}
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <h3 class="text-sm font-semibold text-gray-500 mb-3 uppercase tracking-wider">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> 
                        <div>
                            <label for="{{ form.password.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.password.label }}</label>
                            <input type="password" name="{{ form.password.name }}" id="{{ form.password.id_for_label }}"
                                   placeholder="{{ form.password.field.widget.attrs.placeholder }}"
                                   class="mt-1 block w-full px-3 py-2 border {% if form.password.errors %}border-red-500{% else %}border-gray-300{% endif %} rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
                            {% if form.password.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.password.errors|striptags }}</p>
                            {% endif %}
                        </div>
                        <div>
                            <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.password2.label }}</label>
                            <input type="password" name="{{ form.password2.name }}" id="{{ form.password2.id_for_label }}"
                                   placeholder="{{ form.password2.field.widget.attrs.placeholder }}"
                                   class="mt-1 block w-full px-3 py-2 border {% if form.password2.errors %}border-red-500{% else %}border-gray-300{% endif %} rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
                            {% if form.password2.errors %}
                                <p class="mt-2 text-sm text-red-600">{{ form.password2.errors|striptags }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            {# --- ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤: ‡∏à‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (Logic ‡πÉ‡∏´‡∏°‡πà: Real-time) --- #}
            <div>
                <label class="block text-sm font-medium text-gray-700">‡∏à‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏≠‡∏¢‡∏π‡πà</label>
                
                {# ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á Pill (‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ß‡∏ô‡∏•‡∏π‡∏õ Django ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ JS ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏° Checkbox) #}
                <div id="assigned-points-container" class="mt-2 p-3 border border-gray-200 rounded-md bg-gray-50 min-h-[50px] flex flex-wrap gap-2">
                    <p id="no-assigned-points" class="text-sm text-gray-400 p-2 w-full">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏à‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏î</p>
                    {# Pill ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÇ‡∏î‡∏¢ JavaScript #}
                </div>

                <label class="block text-sm font-medium text-gray-700 mt-4">{{ form.managed_points.label }}</label>
                
                <div class="mt-2 mb-3">
                    <label for="group-filter" class="block text-xs font-medium text-gray-500">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à:</label>
                    <select id="group-filter" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
                        <option value="all">-- ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                        {% for group in service_groups %}
                            <option value="{{ group.id }}">{{ group.name }}</option>
                        {% endfor %}
                        <option value="none">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏•‡∏∏‡πà‡∏° --</option>
                    </select>
                </div>
                
                {# Checkbox List (‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏ß‡∏¢ JS) #}
                <div id="service-point-list" class="h-80 overflow-y-auto border border-gray-300 rounded-md p-4 space-y-2">
                    {% for choice in form.managed_points %}
                    <label class="flex items-center service-point-item cursor-pointer hover:bg-gray-50 p-1 rounded" 
                            data-service-point-id="{{ choice.data.value }}">
                        
                        {# Checkbox ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á #}
                        <div class="mr-2">
                            {{ choice.tag }} 
                        </div>
                        <span class="text-sm text-gray-700 point-label">{{ choice.choice_label }}</span>
                    
                    </label>
                    {% endfor %}
                </div>
            </div>
            
        </div>
        
        <div class="flex justify-end space-x-3 mt-8 border-t pt-6">
            <a href="{% url 'survey:manager_list' %}" class="px-5 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
            <button type="submit" class="px-5 py-2 bg-green-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-green-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
        
    </form>
</div>



<script>
    const spGroupMap = {{ service_point_group_map|default:"{}"|safe }};

    document.addEventListener('DOMContentLoaded', function() {
        const groupFilter = document.getElementById('group-filter');
        const servicePointItems = document.querySelectorAll('.service-point-item'); 
        const assignedContainer = document.getElementById('assigned-points-container');
        const noAssignedMsg = document.getElementById('no-assigned-points');

        // --- 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Pill (‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤) ---
        function createPill(id, name) {
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏õ‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥)
            if (document.getElementById('assigned-pill-' + id)) return;

            const pill = document.createElement('span');
            pill.id = 'assigned-pill-' + id;
            pill.className = "inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 shadow-sm animate-fadeIn";
            
            pill.innerHTML = `
                ${name}
                <button type="button" class="remove-point-btn text-blue-500 hover:text-blue-700 font-bold ml-1 focus:outline-none" data-point-id="${id}">
                    &times;
                </button>
            `;

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö (Event Listener)
            pill.querySelector('.remove-point-btn').addEventListener('click', function() {
                removePill(id);
            });

            assignedContainer.appendChild(pill);
            updateNoAssignedMsg();
        }

        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö Pill ---
        function removePill(id) {
            // ‡∏•‡∏ö Element ‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤
            const pill = document.getElementById('assigned-pill-' + id);
            if (pill) pill.remove();

            // **‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡πÑ‡∏õ‡πÄ‡∏≠‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Checkbox ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á
            const checkbox = document.querySelector(`input[name="managed_points"][value="${id}"]`);
            if (checkbox) {
                checkbox.checked = false;
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (Checkbox ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô‡∏•‡∏¥‡∏™‡∏ï‡πå)
            filterPoints(); 
            updateNoAssignedMsg();
        }

        // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏π‡πÅ‡∏•..." ---
        function updateNoAssignedMsg() {
            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Pill ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° noAssignedMsg ‡πÄ‡∏≠‡∏á)
            const pillCount = assignedContainer.querySelectorAll('span[id^="assigned-pill-"]').length;
            if (pillCount > 0) {
                noAssignedMsg.style.display = 'none';
            } else {
                noAssignedMsg.style.display = 'block';
            }
        }

        // --- 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Filter) ---
        function filterPoints() {
            const selectedGroupId = groupFilter.value; 

            servicePointItems.forEach(function(item) {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const servicePointId = checkbox.value;
                const itemGroupId = spGroupMap[servicePointId] ? String(spGroupMap[servicePointId]) : 'none';
                
                // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å -> ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏à‡∏≤‡∏Å List (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏õ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏õ‡πá‡∏ô Pill ‡πÅ‡∏•‡πâ‡∏ß)
                if (checkbox.checked) {
                    item.style.display = 'none';
                    return; 
                }

                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡πä‡∏Å -> ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Group Filter
                if (selectedGroupId === "" || selectedGroupId === "all") {
                    item.style.display = 'flex';
                } else if (selectedGroupId === itemGroupId) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // --- 5. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Initialization) ---
        
        // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ Checkbox ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà Django ‡∏ï‡∏¥‡πä‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å Database)
        servicePointItems.forEach(function(item) {
            const checkbox = item.querySelector('input[type="checkbox"]');
            const label = item.querySelector('.point-label').textContent;
            const id = checkbox.value;

            // 5.1 ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏±‡∏ô‡∏ï‡∏¥‡πä‡∏Å‡∏≠‡∏¢‡∏π‡πà (‡∏Ñ‡∏∑‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°) -> ‡∏™‡∏£‡πâ‡∏≤‡∏á Pill ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            if (checkbox.checked) {
                createPill(id, label);
            }

            // 5.2 ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö Event ‡∏ï‡∏≠‡∏ô‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    createPill(id, label); // ‡∏™‡∏£‡πâ‡∏≤‡∏á Pill
                    filterPoints();        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô List
                } else {
                    removePill(id);        // (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ)
                }
            });
        });

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Filter ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        groupFilter.value = 'all';
        groupFilter.addEventListener('change', filterPoints);
        
        // ‡∏£‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤
        filterPoints();
        updateNoAssignedMsg();
    });
</script>

<style>
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
    .animate-fadeIn {
        animation: fadeIn 0.2s ease-out;
    }
</style>
{% endblock %}