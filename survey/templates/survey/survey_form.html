{% extends 'index.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto bg-white shadow-2xl rounded-lg p-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-6">{{ page_title }}</h1>

        <form method="POST">
            {% csrf_token %}
            <div class="space-y-6">
                <!-- Title TH -->
                <div>
                    <label for="{{ form.title_th.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.title_th.label }}</label>
                    <input type="text" name="{{ form.title_th.name }}" id="{{ form.title_th.id_for_label }}" 
                            value="{{ form.title_th.value|default:'' }}"
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <!-- Title EN -->
                <div>
                    <label for="{{ form.title_en.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.title_en.label }}</label>
                    <input type="text" name="{{ form.title_en.name }}" id="{{ form.title_en.id_for_label }}" 
                            value="{{ form.title_en.value|default:'' }}"
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <!-- Description -->
                <div>
                    <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.description.label }}</label>
                    <textarea name="{{ form.description.name }}" id="{{ form.description.id_for_label }}" 
                              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 h-24"
                    >{{ form.description.value|default:'' }}</textarea>
                </div>
                <hr>
                <!-- Group -->
                <div>
                    <label for="{{ form.service_group.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.service_group.label }}</label>
                    {{ form.service_group }}
                </div>
                <!-- Point -->
                <div>
                    <label for="{{ form.service_point.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.service_point.label }}</label>
                    {{ form.service_point }}
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Version -->
                    <div class="w-1/3">
                        <label class="block text-sm font-medium text-gray-700">{{ form.version_number.label }}</label>
                        <div class="mt-1">
                            <span class="inline-block px-3 py-2 text-base font-semibold text-indigo-700 bg-indigo-50 rounded-md border border-indigo-200">
                                {{ form.version_number.value|default:'1.0' }}
                            </span>
                        </div>
                        {{ form.version_number }}
                    </div>
                    
                    <!-- Status (Dropdown) -->
                    <div class="w-2/3">
                        <label class="block text-sm font-medium text-gray-700">{{ form.status.label }}</label>
                        <div class="mt-1">
                            {{ form.status }}
                        </div>
                    </div>
                </div>
                
                {% if form.errors %}
                    <div class="text-red-600 text-sm">
                        <p><strong>เกิดข้อผิดพลาด:</strong></p>
                        {{ form.non_field_errors }}
                        {{ form.title_th.errors }}
                        {{ form.service_point.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="mt-8 pt-6 border-t border-gray-200 flex justify-end">
                <a href="{{ cancel_url|default:"#" }}" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg mr-4 hover:bg-gray-300">
                    ยกเลิก
                </a>
                <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg shadow hover:bg-green-700">
                    {{ btn_text }}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- (Script เดิม) -->
<script>
    const pointMap = {{ point_map_json|safe }};
    const groupFilter = document.getElementById('id_group_filter');
    const pointSelect = document.getElementById('id_service_point');
    const tailwindClass = "mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md";
    groupFilter.className = tailwindClass;
    pointSelect.className = tailwindClass;
    const initialPointId = '{{ form.service_point.value|default:"" }}';
    function updatePointDropdown(selectedGroupId) {
        pointSelect.innerHTML = '<option value="">---------</option>';
        if (selectedGroupId && pointMap[selectedGroupId]) {
            const points = pointMap[selectedGroupId];
            points.forEach(function(point) {
                const option = document.createElement('option');
                option.value = point.id;
                option.textContent = point.name;
                if (point.id == initialPointId) { option.selected = true; }
                pointSelect.appendChild(option);
            });
        }
    }
    groupFilter.addEventListener('change', function() { updatePointDropdown(this.value); });
    document.addEventListener('DOMContentLoaded', function() { updatePointDropdown(groupFilter.value); });
</script>
{% endblock %}